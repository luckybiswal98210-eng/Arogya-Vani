<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arogya Vani Health Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .chat-header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .language-selector {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .language-selector label {
            color: white;
            font-size: 14px;
            margin-right: 10px;
            font-weight: bold;
        }

        .language-selector select {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            color: #667eea;
            font-weight: bold;
        }

        .language-selector select:hover {
            background: white;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: #333;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .audio-controls {
            margin-top: 8px;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .audio-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .audio-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }

        .audio-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(1);
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #userInput {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }

        #userInput:focus {
            border-color: #667eea;
        }

        .voice-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            font-size: 18px;
        }

        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn.recording {
            animation: pulse 1s infinite;
            background: #f5576c;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        #sendBtn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.2s;
        }

        #sendBtn:hover {
            transform: scale(1.05);
        }

        #sendBtn:active {
            transform: scale(0.95);
        }

        .typing-indicator {
            display: none;
            padding: 10px 18px;
            background: white;
            border-radius: 18px;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator.show {
            display: block;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: #667eea;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                transform: translateY(0);
            }

            30% {
                transform: translateY(-10px);
            }
        }

        .welcome-message {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .welcome-message h2 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .status-indicator {
            text-align: center;
            padding: 5px;
            font-size: 12px;
            color: white;
            background: rgba(0, 0, 0, 0.2);
            display: none;
        }

        @media (max-width: 600px) {
            .chat-container {
                height: 100vh;
                border-radius: 0;
            }

            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>üè• Arogya Vani Health Chatbot</h1>
            <p>Your AI Health Assistant - Voice & Text Support</p>
        </div>
        <div class="language-selector">
            <label for="outputLanguage">üåê Response Language:</label>
            <select id="outputLanguage">
                <option value="en">English</option>
                <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
            </select>
        </div>
        <div class="status-indicator" id="statusIndicator"></div>
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>Welcome! üôè</h2>
                <p>I'm your health assistant. Describe your symptoms in any language!</p>
                <p style="margin-top: 10px; font-size: 12px;">üí¨ Type or üé§ speak your symptoms<br>üîä Listen to
                    responses with audio playback</p>
            </div>
        </div>
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <button id="voiceBtn" class="voice-btn" title="Voice Input">üé§</button>
                <input type="text" id="userInput" placeholder="Type or speak your symptoms..." autocomplete="off">
                <button id="sendBtn">Send</button>
            </div>
        </div>
    </div>
    <script src="chatbot-data.js"></script>
    <script src="chatbot-conversation-flows.js"></script>
    <script>
        let selectedLanguage = 'en', isRecording = false, recognition = null, currentUtterance = null, currentButtons = null, isPaused = false;

        // Conversation state management
        let conversationState = {
            stage: 'initial',
            symptom: null,
            duration: null,
            severity: null,
            additionalSymptoms: [],
            responses: []
        };

        const chatMessages = document.getElementById('chatMessages'), userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn'), voiceBtn = document.getElementById('voiceBtn');
        const outputLanguageSelect = document.getElementById('outputLanguage'), statusIndicator = document.getElementById('statusIndicator');

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false; recognition.interimResults = false; recognition.lang = 'en-US';
            recognition.onstart = () => { isRecording = true; voiceBtn.classList.add('recording'); voiceBtn.textContent = '‚èπÔ∏è'; showStatus('üé§ Listening...'); };
            recognition.onresult = (event) => { userInput.value = event.results[0][0].transcript; showStatus('‚úÖ Got it!'); setTimeout(() => hideStatus(), 1000); };
            recognition.onerror = (event) => { console.error('Speech recognition error:', event.error); showStatus('‚ùå Error: ' + event.error); setTimeout(() => hideStatus(), 2000); };
            recognition.onend = () => { isRecording = false; voiceBtn.classList.remove('recording'); voiceBtn.textContent = 'üé§'; };
        } else { voiceBtn.disabled = true; voiceBtn.title = 'Voice input not supported in this browser'; }

        outputLanguageSelect.addEventListener('change', (e) => { selectedLanguage = e.target.value; showStatus(`Language changed to ${e.target.options[e.target.selectedIndex].text}`); setTimeout(() => hideStatus(), 2000); });
        voiceBtn.addEventListener('click', () => { if (!recognition) return; if (isRecording) { recognition.stop(); } else { recognition.start(); } });
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

        function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            addMessage(message, 'user'); userInput.value = ''; showTypingIndicator();
            setTimeout(() => { const response = getBotResponse(message, selectedLanguage); hideTypingIndicator(); addMessage(response, 'bot', true); }, 500);
        }

        function addMessage(text, sender, enableAudio = false) {
            const messageDiv = document.createElement('div'); messageDiv.className = `message ${sender}`;
            const contentDiv = document.createElement('div'); contentDiv.className = 'message-content'; contentDiv.textContent = text;
            messageDiv.appendChild(contentDiv);

            if (sender === 'bot' && enableAudio && 'speechSynthesis' in window) {
                const audioControls = document.createElement('div'); audioControls.className = 'audio-controls';
                const playBtn = document.createElement('button'); playBtn.className = 'audio-btn'; playBtn.textContent = 'üîä Play';
                const pauseBtn = document.createElement('button'); pauseBtn.className = 'audio-btn'; pauseBtn.textContent = '‚è∏Ô∏è Pause'; pauseBtn.disabled = true;
                const resumeBtn = document.createElement('button'); resumeBtn.className = 'audio-btn'; resumeBtn.textContent = '‚ñ∂Ô∏è Resume'; resumeBtn.disabled = true; resumeBtn.style.display = 'none';
                const stopBtn = document.createElement('button'); stopBtn.className = 'audio-btn'; stopBtn.textContent = '‚èπÔ∏è Stop'; stopBtn.disabled = true;
                const buttons = { playBtn, pauseBtn, resumeBtn, stopBtn, text };
                playBtn.onclick = () => speakText(buttons); pauseBtn.onclick = () => pauseSpeech(buttons);
                resumeBtn.onclick = () => resumeSpeech(buttons); stopBtn.onclick = () => stopSpeech(buttons);
                audioControls.appendChild(playBtn); audioControls.appendChild(pauseBtn); audioControls.appendChild(resumeBtn); audioControls.appendChild(stopBtn);
                contentDiv.appendChild(audioControls);
            }
            chatMessages.appendChild(messageDiv); chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function getBestVoice(lang) {
            const voices = window.speechSynthesis.getVoices();
            const priorities = {
                'hi-IN': ['Google ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', 'Microsoft Hemant', 'Lekha', 'Google Hindi'],
                'mr-IN': ['Google ‡§Æ‡§∞‡§æ‡§†‡•Ä', 'Microsoft Hemant', 'Google Marathi'],
                'ta-IN': ['Google ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç', 'Microsoft Heera', 'Google Tamil'],
                'bn-IN': ['Google ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ', 'Microsoft Hemant', 'Google Bengali'],
                'te-IN': ['Google ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å', 'Microsoft Heera', 'Google Telugu'],
                'kn-IN': ['Google ‡≤ï‡≤®‡≥ç‡≤®‡≤°', 'Microsoft Heera', 'Google Kannada'],
                'gu-IN': ['Google ‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä', 'Microsoft Hemant', 'Google Gujarati'],
                'en-US': ['Google US English Female', 'Microsoft Zira', 'Samantha', 'Google US English']
            };

            const prefs = priorities[lang] || [];
            for (const pref of prefs) {
                const voice = voices.find(v => v.name.includes(pref));
                if (voice) { console.log('‚úì Selected:', voice.name, 'for', lang); return voice; }
            }

            const langCode = lang.split('-')[0];
            const fallback = voices.find(v => v.lang.startsWith(langCode) || v.lang.includes(langCode));
            if (fallback) { console.log('‚ö† Fallback:', fallback.name, 'for', lang); return fallback; }

            console.warn('‚ùå No voice for', lang); return null;
        }

        function speakText(buttons) {
            if (currentUtterance) { window.speechSynthesis.cancel(); if (currentButtons) resetButtons(currentButtons); }

            const voices = window.speechSynthesis.getVoices();
            if (voices.length === 0) { showStatus('‚è≥ Loading voices...'); setTimeout(() => speakText(buttons), 200); return; }

            const utterance = new SpeechSynthesisUtterance(buttons.text);
            const langCodes = { 'en': 'en-US', 'hi': 'hi-IN', 'mr': 'mr-IN', 'ta': 'ta-IN', 'bn': 'bn-IN', 'te': 'te-IN', 'kn': 'kn-IN', 'gu': 'gu-IN' };
            const langCode = langCodes[selectedLanguage] || 'en-US';

            utterance.lang = langCode;
            const voice = getBestVoice(langCode);
            if (voice) utterance.voice = voice;

            utterance.rate = (selectedLanguage === 'mr' || selectedLanguage === 'gu') ? 0.75 : 0.85;
            utterance.pitch = 1.1;

            utterance.onstart = () => { buttons.playBtn.disabled = true; buttons.pauseBtn.disabled = false; buttons.stopBtn.disabled = false; buttons.resumeBtn.style.display = 'none'; isPaused = false; showStatus('üîä Playing...'); };
            utterance.onend = () => { resetButtons(buttons); currentUtterance = null; currentButtons = null; hideStatus(); };
            utterance.onerror = (e) => { console.error('Speech error:', e); resetButtons(buttons); currentUtterance = null; showStatus('‚ùå Audio error'); setTimeout(() => hideStatus(), 3000); };

            currentUtterance = utterance; currentButtons = buttons;
            window.speechSynthesis.speak(utterance);
        }

        function pauseSpeech(buttons) {
            if (window.speechSynthesis.speaking && !isPaused) {
                window.speechSynthesis.pause(); isPaused = true;
                buttons.pauseBtn.disabled = true; buttons.pauseBtn.style.display = 'none';
                buttons.resumeBtn.disabled = false; buttons.resumeBtn.style.display = 'inline-block';
                showStatus('‚è∏Ô∏è Paused');
            }
        }

        function resumeSpeech(buttons) {
            if (isPaused) {
                window.speechSynthesis.resume(); isPaused = false;
                buttons.resumeBtn.disabled = true; buttons.resumeBtn.style.display = 'none';
                buttons.pauseBtn.disabled = false; buttons.pauseBtn.style.display = 'inline-block';
                showStatus('üîä Playing...');
            }
        }

        function stopSpeech(buttons) { window.speechSynthesis.cancel(); resetButtons(buttons); currentUtterance = null; currentButtons = null; isPaused = false; hideStatus(); }
        function resetButtons(buttons) { buttons.playBtn.disabled = false; buttons.pauseBtn.disabled = true; buttons.pauseBtn.style.display = 'inline-block'; buttons.resumeBtn.disabled = true; buttons.resumeBtn.style.display = 'none'; buttons.stopBtn.disabled = true; isPaused = false; }
        function showStatus(message) { statusIndicator.textContent = message; statusIndicator.style.display = 'block'; }
        function hideStatus() { statusIndicator.style.display = 'none'; }
        function showTypingIndicator() { const indicator = document.createElement('div'); indicator.className = 'message bot'; indicator.id = 'typingIndicator'; const typingDiv = document.createElement('div'); typingDiv.className = 'typing-indicator show'; typingDiv.innerHTML = '<span></span><span></span><span></span>'; indicator.appendChild(typingDiv); chatMessages.appendChild(indicator); chatMessages.scrollTop = chatMessages.scrollHeight; }
        function hideTypingIndicator() { const indicator = document.getElementById('typingIndicator'); if (indicator) indicator.remove(); }
        function getBotResponse(userMessage, outputLang) {
            const detectedLang = detectLanguage(userMessage);
            const normalized = userMessage.toLowerCase().trim();

            // Detect acknowledgment/end phrases
            const ackPhrases = ['ok', 'okay', 'thanks', 'thank you', 'got it', 'understood', 'alright', 'fine', 'good', '‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶', '‡§†‡•Ä‡§ï ‡§π‡•à', '‡§ì‡§ï‡•á', '‡§†‡•Ä‡§ï ‡§Ü‡§π‡•á', '‡Æ®‡Æ©‡Øç‡Æ±‡Æø', '‡Æö‡Æ∞‡Æø', '‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶', '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá', '‡∞ß‡∞®‡±ç‡∞Ø‡∞µ‡∞æ‡∞¶‡∞æ‡∞≤‡±Å', '‡∞∏‡∞∞‡±á', '‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å', '‡≤∏‡≤∞‡≤ø', '‡™Ü‡™≠‡™æ‡™∞', '‡™¨‡™∞‡™æ‡™¨‡™∞'];

            if (ackPhrases.some(p => normalized === p || normalized.includes(p))) {
                const thankYou = {
                    en: 'üôè You\'re welcome! Take care and get well soon. Feel free to ask if you have any other health concerns.',
                    hi: 'üôè ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§Ö‡§™‡§®‡§æ ‡§ñ‡•ç‡§Ø‡§æ‡§≤ ‡§∞‡§ñ‡•á‡§Ç‡•§ ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§',
                    mr: 'üôè ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á! ‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡•Ä ‡§ï‡§æ‡§≥‡§ú‡•Ä ‡§ò‡•ç‡§Ø‡§æ‡•§ ‡§á‡§§‡§∞ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡•á‡§∏‡§æ‡§†‡•Ä ‡§µ‡§ø‡§ö‡§æ‡§∞‡§æ‡•§',
                    ta: 'üôè ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç! ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Æµ‡Æ©‡Æø‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.',
                    bn: 'üôè ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Ø‡¶§‡ßç‡¶® ‡¶®‡¶ø‡¶®‡•§',
                    te: 'üôè ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç! ‡∞Æ‡∞ø‡∞Æ‡±ç‡∞Æ‡∞≤‡±ç‡∞®‡∞ø ‡∞ú‡∞æ‡∞ó‡±ç‡∞∞‡∞§‡±ç‡∞§‡∞ó‡∞æ ‡∞ö‡±Ç‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø‡•§',
                    kn: 'üôè ‡≤∏‡≥ç‡≤µ‡≤æ‡≤ó‡≤§! ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø‡•§',
                    gu: 'üôè ‡™∏‡´ç‡™µ‡™æ‡™ó‡™§ ‡™õ‡´á! ‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™∏‡™Ç‡™≠‡™æ‡™≥ ‡™∞‡™æ‡™ñ‡´ã‡•§'
                };
                resetConversation();
                return thankYou[outputLang] || thankYou.en;
            }

            // Initial stage - detect symptom
            if (conversationState.stage === 'initial') {
                const symptom = findSymptom(userMessage, detectedLang);
                if (symptom && CONVERSATION_FLOWS[symptom]) {
                    conversationState.symptom = symptom;
                    conversationState.stage = 'duration';
                    conversationState.responses.push(userMessage);
                    return CONVERSATION_FLOWS[symptom].questions.duration[outputLang];
                }
                return getResponse(symptom || 'general_discomfort', outputLang);
            }

            // Duration stage
            if (conversationState.stage === 'duration') {
                conversationState.duration = extractDuration(userMessage);
                conversationState.stage = 'severity';
                conversationState.responses.push(userMessage);
                return CONVERSATION_FLOWS[conversationState.symptom].questions.severity[outputLang];
            }

            // Severity stage
            if (conversationState.stage === 'severity') {
                conversationState.severity = extractSeverity(userMessage);
                conversationState.stage = 'additional';
                conversationState.responses.push(userMessage);
                return CONVERSATION_FLOWS[conversationState.symptom].questions.additional[outputLang];
            }

            // Additional symptoms stage - final response
            if (conversationState.stage === 'additional') {
                conversationState.additionalSymptoms = extractAdditionalSymptoms(userMessage);
                conversationState.responses.push(userMessage);
                const finalResponse = generatePersonalizedAdvice(conversationState, outputLang);
                resetConversation();
                return finalResponse;
            }

            return getResponse('general_discomfort', outputLang);
        }

        function extractDuration(text) {
            const numbers = text.match(/\d+/);
            return numbers ? numbers[0] + ' days' : 'a few days';
        }

        function extractSeverity(text) {
            const lower = text.toLowerCase();
            if (SEVERITY_PATTERNS.mild.some(p => lower.includes(p))) return 'mild';
            if (SEVERITY_PATTERNS.severe.some(p => lower.includes(p))) return 'severe';
            if (SEVERITY_PATTERNS.moderate.some(p => lower.includes(p))) return 'moderate';
            return 'moderate';
        }

        function extractAdditionalSymptoms(text) {
            const symptoms = [];
            const lower = text.toLowerCase();
            if (lower.includes('headache') || lower.includes('‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶')) symptoms.push('headache');
            if (lower.includes('fever') || lower.includes('‡§¨‡•Å‡§ñ‡§æ‡§∞')) symptoms.push('fever');
            if (lower.includes('cough') || lower.includes('‡§ñ‡§æ‡§Ç‡§∏‡•Ä')) symptoms.push('cough');
            return symptoms;
        }

        function generatePersonalizedAdvice(state, lang) {
            const baseAdvice = getResponse(state.symptom, lang);
            const durationText = {
                en: `You've had ${state.symptom.replace('_', ' ')} for ${state.duration} with ${state.severity} severity.`,
                hi: `‡§Ü‡§™‡§ï‡•ã ${state.duration} ‡§∏‡•á ${state.severity} ${state.symptom} ‡§π‡•à‡•§`,
                mr: `‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ${state.duration} ‡§™‡§æ‡§∏‡•Ç‡§® ${state.severity} ${state.symptom} ‡§Ü‡§π‡•á‡•§`
            };

            const prefix = durationText[lang] || durationText.en;
            let advice = `${prefix}\n\n${baseAdvice}`;

            if (state.severity === 'severe' || (state.duration && parseInt(state.duration) > 5)) {
                const urgentText = {
                    en: '\n\n‚ö†Ô∏è IMPORTANT: Please consult a doctor immediately as your symptoms are severe or prolonged.',
                    hi: '\n\n‚ö†Ô∏è ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£: ‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§Ø‡§æ ‡§≤‡§Ç‡§¨‡•á ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§π‡•à‡§Ç‡•§',
                    mr: '\n\n‚ö†Ô∏è ‡§Æ‡§π‡§§‡•ç‡§§‡•ç‡§µ‡§æ‡§ö‡•á: ‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡§æ‡§¨‡§°‡§§‡•ã‡§¨ ‡§°‡•â‡§ï‡•ç‡§ü‡§∞‡§æ‡§Ç‡§®‡§æ ‡§≠‡•á‡§ü‡§æ ‡§ï‡§æ‡§∞‡§£ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§≤‡§ï‡•ç‡§∑‡§£‡•á ‡§ó‡§Ç‡§≠‡•Ä‡§∞ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§¶‡•Ä‡§∞‡•ç‡§ò‡§ï‡§æ‡§≥ ‡§Ü‡§π‡•á‡§§‡•§'
                };
                advice += urgentText[lang] || urgentText.en;
            }

            // Add thank you message
            const thankYouText = {
                en: '\n\nüôè Thank you for using Arogya Vani! Take care and get well soon. Feel free to ask if you have any other health concerns.',
                hi: '\n\nüôè ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§µ‡§æ‡§£‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ö‡§™‡§®‡§æ ‡§ñ‡•ç‡§Ø‡§æ‡§≤ ‡§∞‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§ú‡§≤‡•ç‡§¶ ‡§†‡•Ä‡§ï ‡§π‡•ã ‡§ú‡§æ‡§è‡§Ç‡•§ ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•á‡§ù‡§ø‡§ù‡§ï ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§',
                mr: '\n\nüôè ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§µ‡§æ‡§£‡•Ä ‡§µ‡§æ‡§™‡§∞‡§≤‡•ç‡§Ø‡§æ‡§¨‡§¶‡•ç‡§¶‡§≤ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡•Ä ‡§ï‡§æ‡§≥‡§ú‡•Ä ‡§ò‡•ç‡§Ø‡§æ ‡§Ü‡§£‡§ø ‡§≤‡§µ‡§ï‡§∞ ‡§¨‡§∞‡•á ‡§µ‡•ç‡§π‡§æ. ‡§á‡§§‡§∞ ‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ‡§π‡•Ä ‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡•á‡§∏‡§æ‡§†‡•Ä ‡§µ‡§ø‡§ö‡§æ‡§∞‡§æ‡•§',
                ta: '\n\nüôè ‡ÆÜ‡Æ∞‡Øã‡Æï‡Øç‡ÆØ ‡Æµ‡Ææ‡Æ£‡Æø‡ÆØ‡Øà‡Æ™‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡Æ®‡Æ©‡Øç‡Æ±‡Æø! ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Æµ‡Æ©‡Æø‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç, ‡Æµ‡Æø‡Æ∞‡Øà‡Æµ‡Æø‡Æ≤‡Øç ‡Æï‡ØÅ‡Æ£‡ÆÆ‡Æü‡Øà‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç. ‡Æµ‡Øá‡Æ±‡ØÅ ‡Æè‡Æ§‡Øá‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æâ‡Æü‡Æ≤‡Øç‡Æ®‡Æ≤‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æö‡Øç‡Æö‡Æø‡Æ©‡Øà‡Æï‡Æ≥‡Øç ‡Æá‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡Ææ‡Æ≤‡Øç ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.',
                bn: '\n\nüôè ‡¶Ü‡¶∞‡ßã‡¶ó‡ßç‡¶Ø ‡¶¨‡¶æ‡¶£‡ßÄ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Ø‡¶§‡ßç‡¶® ‡¶®‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶π‡¶®‡•§ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§',
                te: '\n\nüôè ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞µ‡∞æ‡∞£‡∞ø‡∞®‡∞ø ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞ø‡∞®‡∞Ç‡∞¶‡±Å‡∞ï‡±Å ‡∞ß‡∞®‡±ç‡∞Ø‡∞µ‡∞æ‡∞¶‡∞æ‡∞≤‡±Å! ‡∞Æ‡∞ø‡∞Æ‡±ç‡∞Æ‡∞≤‡±ç‡∞®‡∞ø ‡∞ú‡∞æ‡∞ó‡±ç‡∞∞‡∞§‡±ç‡∞§‡∞ó‡∞æ ‡∞ö‡±Ç‡∞∏‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞§‡±ç‡∞µ‡∞∞‡∞ó‡∞æ ‡∞ï‡±ã‡∞≤‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø. ‡∞á‡∞§‡∞∞ ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡±Å ‡∞â‡∞Ç‡∞ü‡±á ‡∞Ö‡∞°‡∞ó‡∞Ç‡∞°‡∞ø.',
                kn: '\n\nüôè ‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø ‡≤µ‡≤æ‡≤£‡≤ø ‡≤¨‡≤≥‡≤∏‡≤ø‡≤¶‡≥ç‡≤¶‡≤ï‡≥ç‡≤ï‡≤æ‡≤ó‡≤ø ‡≤ß‡≤®‡≥ç‡≤Ø‡≤µ‡≤æ‡≤¶‡≤ó‡≤≥‡≥Å! ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≥á‡≤ó ‡≤ó‡≥Å‡≤£‡≤Æ‡≥Å‡≤ñ‡≤∞‡≤æ‡≤ó‡≤ø. ‡≤á‡≤§‡≤∞ ‡≤Ü‡≤∞‡≥ã‡≤ó‡≥ç‡≤Ø ‡≤∏‡≤Æ‡≤∏‡≥ç‡≤Ø‡≥Ü‡≤ó‡≤≥‡≤ø‡≤¶‡≥ç‡≤¶‡≤∞‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø.',
                gu: '\n\nüôè ‡™Ü‡™∞‡´ã‡™ó‡´ç‡™Ø ‡™µ‡™æ‡™£‡´Ä‡™®‡´ã ‡™â‡™™‡™Ø‡´ã‡™ó ‡™ï‡™∞‡™µ‡™æ ‡™¨‡™¶‡™≤ ‡™Ü‡™≠‡™æ‡™∞! ‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™∏‡™Ç‡™≠‡™æ‡™≥ ‡™∞‡™æ‡™ñ‡´ã ‡™Ö‡™®‡´á ‡™ú‡™≤‡´ç‡™¶‡´Ä ‡™∏‡™æ‡™ú‡™æ ‡™•‡™æ‡™ì. ‡™Ö‡™®‡´ç‡™Ø ‡™ï‡´ã‡™à ‡™Ü‡™∞‡´ã‡™ó‡´ç‡™Ø ‡™∏‡™Æ‡™∏‡´ç‡™Ø‡™æ ‡™π‡´ã‡™Ø ‡™§‡´ã ‡™™‡´Ç‡™õ‡´ã.'
            };

            advice += thankYouText[lang] || thankYouText.en;

            return advice;
        }

        function resetConversation() {
            conversationState = {
                stage: 'initial',
                symptom: null,
                duration: null,
                severity: null,
                additionalSymptoms: [],
                responses: []
            };
        }
        function detectLanguage(text) { if (/[\u0900-\u097F]/.test(text)) return 'hi'; if (/[\u0980-\u09FF]/.test(text)) return 'bn'; if (/[\u0B80-\u0BFF]/.test(text)) return 'ta'; if (/[\u0C00-\u0C7F]/.test(text)) return 'te'; if (/[\u0C80-\u0CFF]/.test(text)) return 'kn'; if (/[\u0A80-\u0AFF]/.test(text)) return 'gu'; return 'en'; }
        function findSymptom(userInput, language) { const normalized = userInput.toLowerCase().trim(); for (const lang in INPUT_KEYWORDS) { for (const [keyword, symptom] of Object.entries(INPUT_KEYWORDS[lang])) { if (normalized.includes(keyword.toLowerCase())) { return symptom; } } } for (const symptom of Object.keys(RESPONSES_EN)) { if (normalized.includes(symptom.replace('_', ' ')) || normalized.includes(symptom)) { return symptom; } } return null; }
        function getResponse(symptom, language) { if (language === 'en' || !MULTILINGUAL_RESPONSES[language]) { return RESPONSES_EN[symptom] || RESPONSES_EN['general_discomfort']; } const langResponses = MULTILINGUAL_RESPONSES[language] || {}; return langResponses[symptom] || RESPONSES_EN[symptom] || RESPONSES_EN['general_discomfort']; }

        window.addEventListener('load', () => { userInput.focus(); window.speechSynthesis.getVoices(); });
        if (window.speechSynthesis) { window.speechSynthesis.onvoiceschanged = () => { console.log('‚úì Voices loaded:', window.speechSynthesis.getVoices().length); }; }
    </script>
</body>

</html>